<!doctype html>
<html>
  <head>
    <style>
      body { margin: 0; padding: 0; }

      area {
        display: fixed;
        width: 100%;
        height: 100%;
      }

      templates { display: none; }

      sdp { word-break: break-all; }

    </style>
    <script>
      function load() {


        var area = getEl('area'),
            templates = getEl('templates');


        var connectionT = getEl('connection', templates);
        function makeConnectionNode() { return connectionT.cloneNode(true); }

        var el = makeConnectionNode();
        area.appendChild(el);

        var sdpEl = getEl('sdp', el);

        var googleSTUN = getGoogleSTUN();

        var config = {
          'iceServers': [googleSTUN]
        };

        var pc = new RTCPeerConnection(config);

        pc.onnegotiationneeded = function (event) {
          pc
            .createOffer()
            .then(function(offer) {
              // setSdpElText(JSON.stringify(offer));
              console.log(offer);
              setSdpElText(btoa(offer.sdp));
            })
            .catch(function(error) {
              setSdpElText(JSON.stringify(error));
            });
        };

        pc.onicecandidate = function (event) {
          console.log('icecandidate', event);
        };

        function setSdpElText(text) { sdpEl.innerHTML = text; }



        pc.createDataChannel('block');


        function getGoogleSTUN() {
          return {
            urls: [
              'stun:stun1.l.google.com:19302',
              'stun:stun2.l.google.com:19302',
              'stun:stun3.l.google.com:19302',
              'stun:stun4.l.google.com:19302'
            ]
          };
        }

        function getEl(tagName, el) { return (el || document).getElementsByTagName(tagName)[0]; }

      }
    </script>
  </head>
  <body onload="load()">

    <area></area>

    <templates>

      <connection>
        <initiate>
          <sdp></sdp>
          <answer></answer>
        </initiate>
        <receive>
          <offer></offer>
          <answer></answer>
        </receive>
      </connection>

    </templates>

  <body>
</html>